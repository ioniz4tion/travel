<%= render :partial => 'templates/tiles' %>

<%= render :partial => 'templates/slideshow' %>

<%= render :partial => 'templates/flipper' %>

<div class="content">

  <h1>Things to do <span>in <%= @city.name %></span></h1>

  <ul>

    <% @city.gen_attractions.each do |attraction| %>

      <li class="item">
        <div>

          <div class="price-img">
            <%= image_tag(attraction.image_thumb.url) %>
            <div></div>
            <p><%= best_in_place_if user_signed_in?, attraction, :pricing, path: 'gen_attractions/' + attraction.id.to_s %></p>
          </div>

          <div class="description">
            <h2><%= best_in_place_if user_signed_in?, attraction, :name, path: 'gen_attractions/' + attraction.id.to_s %></h2>
            <p><%= best_in_place_if user_signed_in?, attraction, :description, type: :textarea, path: 'gen_attractions/' + attraction.id.to_s %></p>
            <div class="rating">
              <span class="glyphicon glyphicon-star-empty"></span>
              <div>
                <p><%= best_in_place_if user_signed_in?, attraction, :rating, path: 'gen_attractions/' + attraction.id.to_s %><span>/</span>5</p>               
              </div>
              <% if user_signed_in? %>
              Thumbnail Image
               <%= form_for attraction, :url => 'gen_attractions/' + attraction.id.to_s, :html => { :multipart => true } do |form| %>
              <%= form.file_field :image_thumb %>
              <%= form.submit %>
            <% end %>
            <% end %>

            <% if user_signed_in? %>
            Slideshow Image
               <%= form_for attraction, :url => 'gen_attractions/' + attraction.id.to_s, :html => { :multipart => true } do |form| %>
              <%= form.file_field :image %>
              <%= form.submit %>
            <% end %>
            <% end %>
            </div>
          </div>

        </div>

        <div>

          <table>

            <tr>

              <td>
                <span class="glyphicon glyphicon-map-marker"></span>
                <div>
                  <p><%= best_in_place_if user_signed_in?, attraction, :location, path: 'gen_attractions/' + attraction.id.to_s %></p>
                </div>
              </td>

              <td>
                <span class="glyphicon glyphicon-globe"></span>
                <div>
                  <a href="<%= attraction.website_url %>" target="_blank"><%= best_in_place_if user_signed_in?, attraction, :website, path: 'gen_attractions/' + attraction.id.to_s %></a>
                </div>
              </td>

            </tr>

            <tr>

              <td>
                <span class="glyphicon glyphicon-time"></span>
                <div>
                  <p><%= best_in_place_if user_signed_in?, attraction, :hours, path: 'gen_attractions/' + attraction.id.to_s %></p>
                </div>
              </td>

              <td>
                <span class="glyphicon glyphicon-earphone"></span>
                <div>
                  <p><%= best_in_place_if user_signed_in?, attraction, :phone, path: 'gen_attractions/' + attraction.id.to_s %></p>
                </div>
              </td>

            </tr>

          </table>
          <% if user_signed_in? %>
            <%= link_to 'Delete', 'gen_attractions/' + attraction.id.to_s, method: :delete, data: { confirm: 'Are you sure?' } %>
          <% end %>
          <button id="show<%= attraction.iframe_id %>">Show/hide map<span class="caret"></span></button>

        </div>

        <div class="map" id="<%= attraction.iframe_id %>">

          <iframe src="<%= attraction.iframe_url %>"></iframe>

        </div>

      </li>

    <% end %>
    <% if user_signed_in? %>
      <%= link_to 'New Attraction', gen_attractions_path, method: :create %>
    <% end %>
</div>